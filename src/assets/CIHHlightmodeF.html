import React, { useState } from 'react';
import { 
  Play, Pause, Square, RotateCcw, ChevronRight, ChevronLeft, 
  CheckCircle, XCircle, AlertCircle, FileText, Target, ShieldCheck, Zap
} from 'lucide-react';

const cards = [
  {
    title: 'What CMS-485 Is and Why It Matters',
    section: 'Foundation',
    objective: 'Define CMS-485 as the Plan of Care format and connect it to payment and survey outcomes.',
    bullets: [
      'CMS-485 is a structured Plan of Care representation.',
      'Defensible documentation supports patient safety and reimbursement.',
      'Weak POC content increases denial and survey risk.'
    ],
    additional: 'At its core, the CMS-485 is the blueprint of care. Auditors expect one coherent story from certification through claim.',
    challenge: [
      'Use patient-specific POC language tied to objective findings.',
      'Use broad template text without specifics.',
      'Delay updates until episode end.'
    ]
  },
  {
    title: 'Why Documentation Quality Drives Outcomes',
    section: 'Foundation',
    objective: 'Explain the operational impact of complete and traceable POC documentation.',
    bullets: [
      'High-quality documentation reduces claim rework.',
      'Clear rationale improves interdisciplinary handoffs.',
      'Documentation quality is a compliance and care-quality control.'
    ],
    additional: 'Good documentation prevents ADR escalation and supports a smooth handoff between clinicians.',
    challenge: [
      'Treat documentation as a core clinical communication asset.',
      'Only document for billing, not care coordination.',
      'Skip rationale if interventions are listed.'
    ]
  },
  {
    title: 'CoPs Authority for the Plan of Care',
    section: 'Regulatory Authority',
    objective: 'Tie Plan of Care expectations to Conditions of Participation requirements.',
    bullets: [
      'POC must be established and reviewed by authorized practitioner.',
      'Content must remain patient-specific and clinically linked.',
      'Requirements must be operationalized in workflow.'
    ],
    additional: 'CoPs are not policy-only artifacts; they must be visible in daily chart updates and decisions.',
    challenge: [
      'Operationalize CoPs in daily documentation workflow.',
      'Rely on static policy text with no workflow checks.',
      'Use copy-forward language for all recerts.'
    ]
  },
  {
    title: 'Module Review',
    section: 'Quiz',
    objective: 'Check your understanding of the first three topics.',
    bullets: [
      'Select the best answer based on the foundational concepts covered.', 
      'Focus on defensible actions and compliance.', 
      'Review explanations carefully.'
    ],
    additional: 'The primary goal is ensuring that all documentation is patient-specific, timely, and traceable to objective findings.',
    challenge: [
      'Defensible documentation must be specific, timely, and traceable.',
      'Any completed template is equally defensible.',
      'Narrative consistency is optional if coding is correct.'
    ]
  },
  {
    title: 'Completion',
    final: true
  }
];

export default function App() {
  const [cardIndex, setCardIndex] = useState(0);
  const [panelMode, setPanelMode] = useState('main'); // main | additional | challenge
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [isSubmitted, setIsSubmitted] = useState(false);
  const [statusText, setStatusText] = useState('QA mode bypasses locks');

  const card = cards[cardIndex];

  const handleNext = () => {
    if (!card.final && panelMode === 'main') {
      setPanelMode('additional');
    } else if (!card.final && panelMode === 'additional') {
      setPanelMode('challenge');
    } else if (cardIndex < cards.length - 1) {
      setCardIndex(cardIndex + 1);
      setPanelMode('main');
      setSelectedAnswer(null);
      setIsSubmitted(false);
      setStatusText('Ready');
    }
  };

  const handleBack = () => {
    if (panelMode === 'challenge') {
      setPanelMode('additional');
      setSelectedAnswer(null);
      setIsSubmitted(false);
    } else if (panelMode === 'additional') {
      setPanelMode('main');
    } else if (cardIndex > 0) {
      setCardIndex(cardIndex - 1);
      setPanelMode('main');
      setSelectedAnswer(null);
      setIsSubmitted(false);
    }
  };

  const submitChallenge = () => {
    if (selectedAnswer !== null) {
      setIsSubmitted(true);
      setStatusText(selectedAnswer === 0 ? 'Correct answer submitted.' : 'Incorrect answer submitted.');
    }
  };

  return (
    <>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Roboto:wght@300;400;500&display=swap');
        .font-heading { font-family: 'Montserrat', sans-serif; }
        .font-body { font-family: 'Roboto', sans-serif; }
        
        /* Subtle noise texture for depth */
        .bg-noise {
          position: relative;
        }
        .bg-noise::before {
          content: "";
          position: absolute;
          inset: 0;
          background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.03'/%3E%3C/svg%3E");
          pointer-events: none;
          z-index: 10;
        }

        @keyframes snap-slide {
          0% { opacity: 0; transform: translateY(20px) scale(0.99); }
          100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-snap {
          animation: snap-slide 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1) forwards;
        }
      `}</style>

      {/* Light Background - Locked to Screen Height */}
      <div className="h-screen w-full flex items-center justify-center p-4 md:p-8 bg-[#FAFBF8] font-body text-[#1F1C1B] selection:bg-[#007970] selection:text-white bg-noise overflow-hidden">
        
        {/* Debug Chip - Edgy Brutalist */}
        <div className="fixed top-6 right-6 px-4 py-2 text-[10px] font-heading font-bold tracking-[0.2em] uppercase z-50 flex items-center gap-2 bg-[#C74601] text-white border-2 border-[#421700] shadow-[4px_4px_0_#421700] animate-pulse rounded-md">
          <Zap size={14} className="animate-bounce" /> QA: ON
        </div>

        {/* Main Application Container - Clean White, Crisp Shadows */}
        <div className="w-full max-w-5xl h-full max-h-[850px] bg-white border-2 border-[#E5E4E3] shadow-[0_30px_60px_-15px_rgba(31,28,27,0.08)] overflow-hidden flex flex-col relative z-20 rounded-2xl">
          
          {/* Header - Crisp & Clean */}
          <header className="px-8 py-5 flex items-center justify-between border-b-2 border-[#E5E4E3] bg-white relative z-10 shrink-0">
            {/* Standard Gray Logo for Light Mode */}
            <img 
              src="https://cdn.jsdelivr.net/gh/robertp-max/CSM-485-Form@main/src/assets/CI%20Home%20Health%20Logo_Gray.png" 
              alt="CareIndeed" 
              className="h-8 w-auto object-contain transition-transform duration-500 hover:scale-105"
            />
            <div className="text-xl font-heading font-semibold tracking-widest text-[#1F1C1B] bg-[#F7FEFF] px-5 py-1.5 border-2 border-[#007970] shadow-[3px_3px_0_#007970] rounded-lg">
              {cardIndex + 1} <span className="text-[#007970]">/ {cards.length}</span>
            </div>
          </header>

          {/* Bold Gradient Progress Bar */}
          <div className="w-full bg-[#E5E4E3] h-1.5 relative overflow-hidden shrink-0">
            <div 
              className="absolute top-0 left-0 h-full bg-gradient-to-r from-[#007970] via-[#64F4F5] to-[#C74601] transition-all duration-700 ease-out"
              style={{ width: `${((cardIndex + (panelMode === 'main' ? 0.3 : panelMode === 'additional' ? 0.6 : 1)) / cards.length) * 100}%` }}
            />
          </div>

          {/* Dynamic Content Panel - Centered, No Scroll */}
          <main className="flex-1 px-8 py-4 flex flex-col justify-center relative z-10 overflow-hidden bg-white">
            
            {/* Abstract Background Pastel Glows (Subtle for light mode) */}
            <div className="absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-[#C4F4F5]/30 rounded-full blur-[100px] pointer-events-none" />
            <div className="absolute bottom-[-20%] right-[-10%] w-[400px] h-[400px] bg-[#FFD5BF]/30 rounded-full blur-[100px] pointer-events-none" />

            {card.final ? (
              <div className="flex flex-col items-center justify-center h-full text-center animate-snap relative z-10">
                <div className="w-24 h-24 rounded-2xl flex items-center justify-center mb-10 bg-[#007970] text-white border-4 border-[#004142] shadow-[8px_8px_0_#004142] transform -rotate-3 transition-transform hover:rotate-0 duration-300">
                  <CheckCircle size={48} />
                </div>
                <h1 className="text-4xl md:text-6xl font-heading font-semibold mb-6 text-[#1F1C1B] tracking-tight">
                  Course <span className="text-[#007970]">Complete</span>
                </h1>
                <p className="text-lg max-w-lg text-[#524048] font-body leading-relaxed border-l-4 border-[#C74601] pl-6 text-left bg-[#FFFAF7] p-4 rounded-r-lg">
                  You have successfully completed the Plan of Care Foundation module. Your responses are securely logged.
                </p>
              </div>
            ) : (
              <div key={cardIndex + panelMode} className="animate-snap opacity-0 relative z-10 w-full max-w-4xl mx-auto">
                
                {/* Common Header */}
                <div className="mb-8">
                  <div className="inline-flex items-center gap-3 mb-4 bg-[#FFEEE5] px-4 py-1.5 rounded-full border border-[#C74601]/20">
                    <div className="w-2 h-2 rounded-full bg-[#C74601] animate-pulse" />
                    <span className="text-xs font-heading font-semibold uppercase tracking-[0.15em] text-[#C74601]">
                      {card.section}
                    </span>
                  </div>
                  <h1 className="text-3xl md:text-5xl font-heading font-semibold leading-tight text-[#1F1C1B]">
                    {card.title}
                  </h1>
                </div>

                {/* PANEL STATES */}
                {panelMode === 'main' && (
                  <div className="space-y-5">
                    {/* Objective Block - Bold Teal Anchor */}
                    <div className="p-5 md:p-6 bg-[#007970] border-2 border-[#004142] shadow-[6px_6px_0_#004142] rounded-xl text-white relative overflow-hidden">
                      <div className="flex gap-4 items-start relative z-10">
                        <Target className="shrink-0 mt-1 text-[#64F4F5]" size={32} strokeWidth={2} />
                        <div>
                          <h2 className="text-xs font-heading font-bold uppercase tracking-[0.15em] mb-2 text-[#C4F4F5]">
                            Learning Objective
                          </h2>
                          <p className="text-xl font-body font-normal leading-snug text-white">
                            {card.objective}
                          </p>
                        </div>
                      </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                      {/* Key Points - Sharp Interactive Card */}
                      <div className="p-5 md:p-6 bg-white border-2 border-[#E5E4E3] hover:border-[#007970] transition-all duration-300 group flex flex-col justify-center rounded-xl hover:shadow-[6px_6px_0_#007970] hover:-translate-y-1 hover:-translate-x-1">
                        <h2 className="text-lg font-heading font-semibold mb-4 flex items-center gap-2 text-[#1F1C1B]">
                          <div className="bg-[#E5FEFF] p-1.5 rounded-lg text-[#007970] group-hover:bg-[#007970] group-hover:text-white transition-colors">
                            <FileText size={20} />
                          </div>
                          Key Points
                        </h2>
                        <ul className="space-y-3">
                          {card.bullets.map((b, i) => (
                            <li key={i} className="flex gap-3 items-start group/item">
                              <span className="text-[#007970] font-heading font-bold text-sm mt-0.5 transition-transform group-hover/item:translate-x-1">0{i+1}</span>
                              <span className="text-[#524048] text-sm md:text-base font-body leading-relaxed">{b}</span>
                            </li>
                          ))}
                        </ul>
                      </div>

                      {/* Clinical Lens - Orange Interactive Card */}
                      <div className="p-5 md:p-6 bg-white border-2 border-[#E5E4E3] hover:border-[#C74601] transition-all duration-300 group flex flex-col justify-center rounded-xl hover:shadow-[6px_6px_0_#C74601] hover:-translate-y-1 hover:-translate-x-1">
                        <h2 className="text-lg font-heading font-semibold mb-4 flex items-center gap-2 text-[#1F1C1B]">
                          <div className="bg-[#FFEEE5] p-1.5 rounded-lg text-[#C74601] group-hover:bg-[#C74601] group-hover:text-white transition-colors">
                            <ShieldCheck size={20} />
                          </div>
                          Clinical Lens
                        </h2>
                        <p className="text-[#524048] text-sm md:text-base font-body leading-relaxed">
                          Translate this concept into clear, patient-specific, defensible documentation language that aligns directly with organizational standards.
                        </p>
                      </div>
                    </div>
                  </div>
                )}

                {panelMode === 'additional' && (
                  <div className="flex flex-col justify-center py-4">
                    <div className="p-8 lg:p-12 bg-white border-2 border-[#D9D6D5] shadow-[8px_8px_0_#D9D6D5] rounded-xl relative group transition-all hover:shadow-[8px_8px_0_#007970] hover:border-[#007970]">
                      <div className="absolute top-0 right-0 w-24 h-24 border-t-4 border-r-4 border-[#007970] opacity-20 rounded-tr-xl transition-all duration-500 group-hover:opacity-100" />
                      <div className="absolute bottom-0 left-0 w-24 h-24 border-b-4 border-l-4 border-[#C74601] opacity-20 rounded-bl-xl transition-all duration-500 group-hover:opacity-100" />
                      
                      <h2 className="text-xs font-heading font-bold uppercase tracking-[0.15em] mb-6 flex items-center gap-2 text-[#C74601]">
                        <AlertCircle size={18} /> Expanded Context
                      </h2>
                      <p className="text-2xl md:text-3xl leading-snug font-body font-light text-[#1F1C1B]">
                        {card.additional}
                      </p>
                    </div>
                  </div>
                )}

                {panelMode === 'challenge' && (
                  <div className="space-y-6">
                    <h2 className="text-2xl font-heading font-semibold mb-6 text-[#1F1C1B] tracking-tight flex items-center gap-3">
                      <Target className="text-[#C74601]" size={28} />
                      Identify the optimal approach.
                    </h2>
                    <div className="space-y-4">
                      {card.challenge.map((c, i) => {
                        let btnClasses = "w-full text-left p-4 md:p-5 border-2 transition-all duration-300 flex items-center justify-between group cursor-pointer font-body text-sm md:text-base rounded-xl ";
                        
                        if (isSubmitted) {
                          if (i === 0) {
                            btnClasses += "border-[#007970] bg-[#007970] text-white shadow-[6px_6px_0_#004142] scale-[1.01]";
                          } else if (selectedAnswer === i) {
                            btnClasses += "border-[#D70101] bg-[#D70101] text-white shadow-[6px_6px_0_#7a0000]";
                          } else {
                            btnClasses += "border-[#E5E4E3] bg-[#FAFBF8] text-[#747474] opacity-50";
                          }
                        } else if (selectedAnswer === i) {
                          btnClasses += "border-[#007970] bg-[#E5FEFF] text-[#007970] shadow-[6px_6px_0_#007970] -translate-y-1 -translate-x-1 font-medium";
                        } else {
                          btnClasses += "border-[#E5E4E3] bg-white text-[#524048] hover:border-[#007970] hover:shadow-[6px_6px_0_#007970] hover:-translate-y-1 hover:-translate-x-1 hover:text-[#1F1C1B]";
                        }

                        return (
                          <button
                            key={i}
                            disabled={isSubmitted}
                            onClick={() => setSelectedAnswer(i)}
                            className={btnClasses}
                          >
                            <span className="pr-4 leading-relaxed">{c}</span>
                            <div className="shrink-0 transition-transform duration-300 group-hover:scale-110">
                              {isSubmitted && i === 0 && <CheckCircle size={22} className="text-white" />}
                              {isSubmitted && selectedAnswer === i && i !== 0 && <XCircle size={22} className="text-white" />}
                              {!isSubmitted && selectedAnswer === i && <CheckCircle size={22} className="text-[#007970]" />}
                              {!isSubmitted && selectedAnswer !== i && <div className="w-5 h-5 rounded-full border-2 border-[#D9D6D5] group-hover:border-[#007970]" />}
                            </div>
                          </button>
                        );
                      })}
                    </div>

                    {/* Challenge Action Area */}
                    <div className="pt-4 flex flex-col md:flex-row items-center gap-4">
                      <button
                        onClick={submitChallenge}
                        disabled={selectedAnswer === null || isSubmitted}
                        className="group px-8 py-4 font-heading font-bold text-xs uppercase tracking-[0.15em] text-white transition-all duration-300 disabled:opacity-40 disabled:cursor-not-allowed w-full md:w-auto bg-[#C74601] border-2 border-[#421700] hover:bg-[#E56E2E] hover:shadow-[6px_6px_0_#421700] hover:-translate-y-1 hover:-translate-x-1 flex items-center justify-center gap-2 rounded-xl"
                      >
                        Execute
                        {!isSubmitted && selectedAnswer !== null && (
                          <ChevronRight size={16} className="transition-transform group-hover:translate-x-1" />
                        )}
                      </button>
                      
                      {isSubmitted && (
                        <div className={`p-4 flex-1 animate-snap border-2 rounded-xl ${selectedAnswer === 0 ? 'bg-[#E5FEFF] border-[#007970] text-[#007970]' : 'bg-[#FFF0F0] border-[#D70101] text-[#D70101]'}`}>
                          <p className="text-xs font-heading font-bold uppercase tracking-[0.1em] flex items-center gap-2">
                            {selectedAnswer === 0 ? <><CheckCircle size={16}/> Validation Success: Concept applied correctly.</> : <><XCircle size={16}/> Validation Error: Focus on defensible actions.</>}
                          </p>
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </div>
            )}
          </main>

          {/* Footer / Media Controls - Clean, Structured */}
          <footer className="px-8 py-4 border-t-2 border-[#E5E4E3] bg-[#FAFBF8] flex items-center justify-between gap-4 relative z-10 shrink-0">
            <button 
              onClick={handleBack}
              className="group flex items-center gap-2 px-4 py-3 font-heading font-semibold text-xs uppercase tracking-widest transition-all duration-300 text-[#747474] hover:text-[#1F1C1B] rounded-lg hover:bg-[#E5E4E3]"
            >
              <ChevronLeft size={16} className="transition-transform group-hover:-translate-x-1" /> Return
            </button>

            {!card.final && (
              <div className="flex flex-col items-center gap-2">
                <div className="flex items-center gap-1 p-1 border-2 border-[#E5E4E3] bg-white rounded-xl shadow-sm">
                  {panelMode === 'main' ? (
                    <button 
                      onClick={() => { setPanelMode('additional'); setStatusText('System: Playing Audio Protocol'); }}
                      className="group flex items-center gap-2 px-6 py-2 text-[#007970] font-heading font-bold text-xs uppercase tracking-widest transition-all duration-300 hover:bg-[#E5FEFF] rounded-lg"
                    >
                      <Play size={12} fill="currentColor" className="transition-transform group-hover:scale-110" />
                      Initialize Audio
                    </button>
                  ) : (
                    <>
                      <button onClick={() => setStatusText('System: Audio Paused')} className="p-2.5 text-[#747474] hover:text-[#1F1C1B] hover:bg-[#E5E4E3] transition-colors rounded-lg" title="Pause">
                        <Pause size={14} fill="currentColor" />
                      </button>
                      <button onClick={() => setStatusText('System: Audio Terminated')} className="p-2.5 text-[#747474] hover:text-[#D70101] hover:bg-[#FFF0F0] transition-colors rounded-lg" title="Stop">
                        <Square size={14} fill="currentColor" />
                      </button>
                      <button onClick={() => setStatusText('System: Audio Restarted')} className="p-2.5 text-[#747474] hover:text-[#007970] hover:bg-[#E5FEFF] transition-colors rounded-lg" title="Restart">
                        <RotateCcw size={14} />
                      </button>
                      <div className="w-px h-6 bg-[#E5E4E3] mx-1"></div>
                      <button 
                        onClick={() => setPanelMode('challenge')}
                        className="group flex items-center gap-2 px-4 py-2 font-heading font-bold text-xs uppercase tracking-widest transition-all duration-300 text-[#C74601] hover:bg-[#FFEEE5] rounded-lg"
                      >
                        Enter Challenge
                        <Target size={12} className="transition-transform group-hover:rotate-90" />
                      </button>
                    </>
                  )}
                </div>
                <span className="text-[9px] font-heading font-bold uppercase tracking-[0.2em] text-[#747474] animate-pulse">
                  {statusText}
                </span>
              </div>
            )}

            <button 
              onClick={handleNext}
              className="group flex items-center gap-2 px-6 py-3 rounded-xl font-heading font-bold text-xs uppercase tracking-[0.15em] text-white transition-all duration-300 bg-[#007970] border-2 border-[#004142] hover:bg-[#006059] hover:shadow-[4px_4px_0_#004142] hover:-translate-y-1 hover:-translate-x-1"
            >
              {card.final ? 'Complete' : 'Advance'} 
              <ChevronRight size={14} className="transition-transform group-hover:translate-x-1" />
            </button>
          </footer>
        </div>
      </div>
    </>
  );
}